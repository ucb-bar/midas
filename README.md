# MIDAS

MIDAS is an FPGA simulation simulation framework that automatically generates platform agnostic FPGA simulators from any RTL designs. MIDAS is an improvement over [Strober](http://dl.acm.org/citation.cfm?id=3001151) that was originally implemented for sample-based energy simulation.

## Dependencies

This repo depends on the following projects:
* [Chisel](https://github.com/freechipsproject/chisel3): RTL implementations in MIDAS/Strober are written with Chisel
* [FIRRTL](https://github.com/freechipsproject/firrtl): Custom transforms in MIDAS/Strober are written with FIRRTL
* [RocketChip](https://github.com/freechipsproject/rocket-chip.git): RocketChip is not only a chip generator, but also a collection of useful libraries for various hardware designs. We take advantage of some libraries in RocketChip.
* [barstools](https://github.com/ucb-bar/barstools): Technology dependent custom transforms(e.g. macro compiler) are used for Strober.

Thie repo is not supposed to work alone. It is instantiated in top-level projects with target designs such as [strober-examples](https://github.com/donggyukim/strober-examples) and [midas-top](https://github.com/ucb-bar/midas-top.git).

## How to Use?

### MIDAS Compiler

To generate the Verilog file of the FPGA simulator, just pass the target design with a configuration to `MidasCompiler`:
```scala
// mod: Module (target design)
// dir: File (target directory)
// p: config.Parameters (midas configuration)
midas.MidasCompiler(mod, dir)(p)
```

If you have a JSON file describing the target technology generated by [PLSI](https://github.com/ucb-bar/hammer), pass it as:
```scala
// lib: File (technology description)
midas.MidasCompiler(mod, dir, Some(lib))(p)
```

Here are two examples in [strober-example](https://github.com/donggyukim/strober-examples/blob/master/src/main/scala/Main.scala) and [midas-top](https://github.com/ucb-bar/midas-top/blob/master/src/main/scala/Generator.scala#L161).

### MIDAS Configurations

The default MIDAS parameters are given in [src/main/scala/midas/Config.scala](https://github.com/ucb-bar/midas/blob/readme/src/main/scala/midas/Config.scala). You can just pass `ZynqConfig` to obtain performance simulation and `ZynqConfigWithSnapshot` to plug Strober in for power/energy simulation for Xilinx Zynq boards.

You may want to override some parameters on top of the default parameter values. This is an example how you can instantiate an MIDAS LLC model:
```scala
class WithMidasLLC(extends Config((site, here, up) => {
  case MidasLLCKey => Some(MidasLLCParameters(nWays = 8, nSets = 4096, blockBytes = 128)) // capacity <= 4MiB
})

class ZynqConfigWithLLC(new ZynqConfig ++ new WithMidasLLC)
```
